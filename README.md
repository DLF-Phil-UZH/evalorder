Eva
===

Evaluation order form for lecturers/assistants with automated XML generation for import to EvaSys of Studienangebotsentwicklung of the University of Zurich

# Installation
This installation manual describes how Eva can be installed on a standard webhosting environment at the University of Zurich.

## 1 Setup a database
Create a new MySQL-database and use the SQL-File 'create_db.sql' to create the tables for Eva.
In this installation guide, the following database properties are used as an example:

	hostname: mysql.example.com
	username: demo
	password: test
	database: demo

## 2 Create directories for the xls(x) and xml files
Create one new directory where the xls(x) files that are being upload via Eva will be stored. Then create one directory where the downloadable xml files generated by the application will be stored. Both directories should not be in your document root and not accessible via the web, but must be writable by the php process. At the University of Zurich create these directories in the same location where the directory 'public_html' is located (not inside 'public_html'!). Set the rights for this directory to 777.

In this installation guide, the following directory is created:

	/usr/local/ftp/test/upload_files
	/usr/local/ftp/test/download_files


## 3 Upload files to the server
Create a new directory for Eva on your webserver or just upload the files to your document root, if you only install Eva.

In this guide, the files are being uploaded to:

	/usr/local/ftp/test/public_html/static/eva

## 4 Edit .htaccess in the base directory of eva
- Set the RewriteBase to the full filesystem path to the directory in which you uploaded the eva files (where your index.php and the .htaccess are located) (no trailing slash):

	Line 13:
	`RewriteBase /test/static/eva`

- Add the URL under which the Eva installation can be accessed to the RewriteRule. This makes sure, that all Requests are redirected to https:

	Line 20:
	`RewriteRule ^(.*) https://www.uzh.ch/test/static/eva/$1 [L]`

## 5 Configure eva

### 5.1 Edit application/config/config.php

Set the 'base_url' to the same as the URL used in step 4 for the RewriteRule. Don't forget the trailing slash:

Line 18:
	`$config['base_url'] = 'https://www.uzh.ch/test/static/eva/';`

Set the 'xls_folder' and 'xml_folder' to the full filesystem path (with trailing slash) of the directory you created in step 2.

Line 370:
	`$config['xls_folder'] = '/usr/local/ftp/test/eva/upload_files/';`
	Line 382:
	`$config['xml_folder'] = '/usr/local/ftp/test/eva/download_files/';`

### 5.2 Edit application/config/database.php

Fill in the details for the database you created in step 1.

	$db['default']['hostname'] = 'mysql.example.com';
	$db['default']['username'] = 'demo';
	$db['default']['password'] = 'test';
	$db['default']['database'] = 'demo';

### 5.3 Edit assets/js/orderform_library.js

Set the base urls to the same value as in step 5.1 (with trailing slash).

Line 277:
	`var baseURL = "https://www.uzh.ch/test/static/eva/";`
	Line 411:
	`var baseURL = "https://www.uzh.ch/test/static/eva/";`

### 5.4 Set $_SERVER['HTTP_UNIQUEID'] values for every admin to grant backend access in application/controllers/admin.php

Line 16:
	`if($_SERVER['HTTP_UNIQUEID']=="<admin 1>" | $_SERVER['HTTP_UNIQUEID']=="<admin 2>" ... ){`

**Thats it, Eva is set up and running!** Test if it works:

https://www.uzh.ch/test/static/eva/

Now there are 2 more steps:

# 6 Edit index.php in the base directory of eva

Set the 'ENVIRONMENT' to 'production':

Line 21:
	`define('ENVIRONMENT', 'production');`

# 7 Edit application/config/standardwerte_config.php

Fix configuration values for order and xml generation processes can be changed directly in this file.
Variable values that change every semester can either be changed directly in this file or via backend. Make sure the three task datetimes are in ascending order.

# 8 Future changes

## 8.1 Survey form codes
Currently there are 6 different survey forms in use for a total of 32 different combinations of course type, lecturer number and language. As soon as the updated survey form codes are known, they can be adapted in application/config/standardwerte_config.php.
Caution: Scheme of file names (<course type with first letter as capital>_<[e|m] for 1/more lecturers>D_<[D|E|I] for language>_p<page number>.jpg]) for corresponding preview images has to be preserved!

## 8.2 Italian survey forms
Currently there are only german and english forms available for paper surveys. Caution: Scheme of file names (<course type with first letter as capital>_<[e|m] for 1/more lecturers>D_<[D|E|I] for language>_p<page number>.jpg) for corresponding preview images has to be preserved!
As soon as italian forms are released, the prepared code can be uncommented to be activated:

- application/config/standardwerte_config.php:
	- Add distinction for italian survey forms
- application/controllers/evalorderform.php:
	- Uncomment commented parts of lines 355 and 356 in checkSprache()
- application/models/course_model.php:
	- Uncomment commented parts of lines 286 and 287 in getSurveyForm()
- application/views/orderform.php:
	- Uncomment lines 222 and 223
- assets/js/orderform_library.js:
	- Uncomment lines 290 to 293 in displayFormPreview()
